# 작성일 2026 01 12
# 작업자 윤성민 책임
# 설명 이 설정은 dev docker compose 환경에서 프론트 정적 파일을 Nginx로 서빙한다
# 설명 프론트에서 fetch로 호출하는 api 경로는 같은 compose 네트워크의 backend 서비스로 프록시하여 CORS와 포트 의존을 제거한다
# 설명 로컬 개발에서는 Vite proxy가 동일 역할을 수행하고 dev 컨테이너에서는 본 설정이 동일 역할을 수행한다
# 설명 존재하지 않는 경로는 단일 페이지 애플리케이션 라우팅을 위해 index html로 되돌려 프론트 라우터가 처리한다
# 설명 향후 쿠버네티스 전환 시에도 ingress에서 api 경로를 백엔드로 라우팅하거나 본 설정을 유지하는 방식으로 최소 수정 전환이 가능하다

server {
  listen 80;
  server_name _;

  root /usr/share/nginx/html;
  index index.html;

  # 설명 api 요청은 backend 컨테이너로 전달한다
  location /api/ {
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    proxy_pass http://backend:8080;
  }

  # 설명 정적 파일은 그대로 서빙하고 나머지는 spa 엔트리로 fallback 한다
  location / {
    try_files $uri $uri/ /index.html;
  }
}
