# 작성일 2026 01 09
# 작업자 윤성민
# 설명 이 파일은 절차 검증을 위해 local 환경을 컨테이너 기반으로 구성하는 Docker Compose 파일이다
# 설명 dev test prod와 동일한 패턴으로 backend frontend db를 컨테이너로 기동하여 승격 절차를 로컬 PC에서 시뮬레이션한다
# 설명 실제 로컬 개발은 IntelliJ에서 백엔드를 실행하고 프론트는 Vite 개발 서버를 사용하므로 infra/docker-compose.local.yml 파일을 사용한다

services:
  postgres:
    image: postgres:18
    container_name: pms-local-postgres
    restart: unless-stopped
    ports:
      - "${DB_PORT_LOCAL:-5433}:5432"
    environment:
      POSTGRES_DB: ${POSTGRES_DB_LOCAL:-pms}
      POSTGRES_USER: ${POSTGRES_USER_LOCAL:-pms}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD_LOCAL:-pms}
    volumes:
      # 설명 Postgres 18 이상은 /var/lib/postgresql 아래에 마운트하고 데이터는 하위 디렉터리에 저장하는 구성이 권장된다
      - postgres-local-data:/var/lib/postgresql

  backend:
    image: ${BACKEND_IMAGE_LOCAL:-pms-backend}:${BACKEND_TAG_LOCAL:-local}
    container_name: pms-local-backend
    restart: unless-stopped
    depends_on:
      - postgres
    ports:
      - "${BACKEND_PORT_LOCAL:-9080}:8080"
    environment:
      SPRING_PROFILES_ACTIVE: ${SPRING_PROFILES_ACTIVE_LOCAL:-local}
      SPRING_DATASOURCE_URL: ${SPRING_DATASOURCE_URL_LOCAL:-jdbc:postgresql://postgres:5432/pms}
      SPRING_DATASOURCE_USERNAME: ${SPRING_DATASOURCE_USERNAME_LOCAL:-pms}
      SPRING_DATASOURCE_PASSWORD: ${SPRING_DATASOURCE_PASSWORD_LOCAL:-pms}

  frontend:
    image: ${FRONTEND_IMAGE_LOCAL:-pms-frontend}:${FRONTEND_TAG_LOCAL:-local}
    container_name: pms-local-frontend
    restart: unless-stopped
    depends_on:
      - backend
    ports:
      - "${FRONTEND_PORT_LOCAL:-9081}:80"

volumes:
  postgres-local-data:

